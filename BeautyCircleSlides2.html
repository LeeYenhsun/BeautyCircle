import React, { useState, useEffect } from 'react';
import { 
  ChevronLeft, 
  ChevronRight, 
  MapPin, 
  Bell, 
  TrendingUp, 
  ShieldCheck, 
  Users, 
  Wallet, 
  Layout, 
  CheckCircle,
  AlertCircle,
  BarChart3,
  Clock
} from 'lucide-react';

const App = () => {
  const [currentSlide, setCurrentSlide] = useState(0);

  const slides = [
    {
      id: 1,
      title: "美力圈 Beauty Circle",
      subtitle: "職人數位長城",
      desc: "由公會引領，整合地理圍欄與誠信機制，守護職人尊嚴，鎖定商圈產值。",
      bg: "https://images.unsplash.com/photo-1560750588-73207b1ef5b8?auto=format&fit=crop&q=80&w=2000",
      layout: "hero"
    },
    {
      id: 2,
      title: "400 億產值的數位隱形危機",
      type: "crisis",
      stats: [
        { label: "行銷通膨", value: "35%", sub: "廣告成本增長" },
        { label: "產值浪費", value: "12%", sub: "No-show 比例" },
        { label: "單店損失", value: "20萬+", sub: "年平均損失純利" }
      ],
      desc: "美業市場巨大，但店家面臨廣告昂貴、客人放鳥、路人進不來的「數位孤島」困境。",
      img: "https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?auto=format&fit=crop&q=80&w=1000"
    },
    {
      id: 3,
      title: "核心武器：地理圍欄推播",
      subtitle: "Geofencing Technology",
      features: [
        { icon: <MapPin className="w-8 h-8 text-[#E5B1A1]" />, title: "精準定位", text: "進入店周 1km 商圈立即啟動感應" },
        { icon: <Bell className="w-8 h-8 text-[#E5B1A1]" />, title: "驚喜推播", text: "鎖屏彈出限時優惠，點擊率 15%+" },
        { icon: <TrendingUp className="w-8 h-8 text-[#E5B1A1]" />, title: "即時轉換", text: "將路人直接轉化為進店消費客" }
      ]
    },
    {
      id: 4,
      title: "產值防禦：補位快攻系統",
      subtitle: "Slot Rescue System",
      highlight: "「讓每一分鐘都不被浪費」",
      desc: "遇到預約取消？一鍵發布「即時空檔」。只要 30% 補位成功，單店每年可增加 7 萬純利。這不只是工具，是補足缺口的營收保險。",
      img: "https://images.unsplash.com/photo-1521590832167-7bcbfaa6381f?auto=format&fit=crop&q=80&w=1000"
    },
    {
      id: 5,
      title: "數位存摺：鎖定信任感",
      subtitle: "Digital Passbook",
      points: [
        "公會見證：消除對小店倒閉捲款的恐懼",
        "折扣自動化：滿萬送千、套票數位管理",
        "回訪提醒：餘額久未異動自動暖心推播"
      ],
      mockup: true
    },
    {
      id: 6,
      title: "雙軌積分：防弊與導流",
      subtitle: "Incentive Logic",
      grid: [
        { 
          title: "美麗積分 (防弊)", 
          desc: "消費者為了點數會主動監督報帳，確保公會分潤紀錄不漏報。",
          label: "監單誘因" 
        },
        { 
          title: "好友圈 (社交)", 
          desc: "透過真實邀請建立品味圈，好友消費得獎勵，口碑更真實。",
          label: "裂變推廣" 
        }
      ]
    },
    {
      id: 7,
      title: "商業模式：方案 B 公會分潤",
      subtitle: "Business Model Scheme B",
      steps: [
        { title: "不碰金流", desc: "現金直接進店家口袋，規避法律風險" },
        { title: "月結分潤", desc: "5% 服務費，公會與平台共同維運" },
        { title: "分潤對沖", desc: "店家吸收折抵點數，可抵銷應繳服務費" }
      ]
    },
    {
      id: 8,
      title: "職人尊嚴：誠信預警系統",
      subtitle: "Security & Trust",
      features: [
        { icon: <ShieldCheck className="w-12 h-12" />, title: "商家分級", text: "累積誠信數據，晉升黃金級解鎖進階特權" },
        { icon: <AlertCircle className="w-12 h-12 text-rose-400" />, title: "風險標籤", text: "去識別化預警慣性放鳥客，遠離奧客" }
      ]
    },
    {
      id: 9,
      title: "三階段發展藍圖",
      subtitle: "Development Roadmap",
      phases: [
        { label: "V1 生存期", items: ["補位工具", "數位建檔規費", "儲值紀錄落地"] },
        { label: "V2 成長期", items: ["美麗金積分循環", "月結分潤啟動", "跨店生態系"] },
        { label: "V3 穩定期", items: ["誠信護城河", "B2B 廣告引擎", "產業大數據中心"] }
      ]
    },
    {
      id: 10,
      title: "讓每一分鐘的專業",
      subtitle: "都值得被珍惜",
      final: true,
      desc: "這不僅是技術升級，更是產業地位的翻轉。讓我們一起為美業創造下一個黃金十年。",
      bg: "https://images.unsplash.com/photo-1560750588-73207b1ef5b8?auto=format&fit=crop&q=80&w=2000"
    }
  ];

  const nextSlide = () => setCurrentSlide((prev) => (prev + 1) % slides.length);
  const prevSlide = () => setCurrentSlide((prev) => (prev - 1 + slides.length) % slides.length);

  useEffect(() => {
    const handleKeyDown = (e) => {
      if (e.key === 'ArrowRight') nextSlide();
      if (e.key === 'ArrowLeft') prevSlide();
    };
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, []);

  const slide = slides[currentSlide];

  return (
    <div className="flex flex-col h-screen bg-[#F9F5F1] text-[#333333] font-sans selection:bg-[#E5B1A1]">
      {/* Top Progress Bar */}
      <div className="w-full h-1 bg-gray-200">
        <div 
          className="h-full bg-[#E5B1A1] transition-all duration-500 ease-out"
          style={{ width: `${((currentSlide + 1) / slides.length) * 100}%` }}
        />
      </div>

      {/* Main Content Area */}
      <main className="flex-grow relative overflow-hidden flex items-center justify-center p-6 md:p-12">
        <div className="max-w-6xl w-full h-full flex items-center">
          
          {/* Slide Content Logic */}
          <div className="w-full animate-in fade-in slide-in-from-bottom-4 duration-700">
            {slide.layout === "hero" || slide.final ? (
              <div className="relative h-[80vh] w-full rounded-3xl overflow-hidden shadow-2xl flex items-center justify-center text-center p-12">
                <div className="absolute inset-0 z-0">
                  <img src={slide.bg} className="w-full h-full object-cover opacity-40 grayscale-[0.3]" alt="bg" />
                  <div className="absolute inset-0 bg-gradient-to-t from-[#F9F5F1] via-transparent to-transparent opacity-60" />
                </div>
                <div className="relative z-10">
                  <span className="text-[#C5A059] tracking-[0.5em] font-medium mb-6 block">BEAUTY CIRCLE</span>
                  <h1 className="text-5xl md:text-8xl font-serif mb-6 leading-tight text-[#333333]">
                    {slide.title.split(' ')[0]} <br/>
                    <span className="text-[#E5B1A1] font-light">{slide.title.split(' ').slice(1).join(' ')}</span>
                  </h1>
                  <h2 className="text-2xl md:text-3xl font-light mb-8 text-[#C5A059]">{slide.subtitle}</h2>
                  <p className="max-w-2xl mx-auto text-lg text-gray-600 leading-relaxed">{slide.desc}</p>
                  {slide.final && (
                    <button className="mt-12 px-10 py-4 border-2 border-[#E5B1A1] text-[#E5B1A1] rounded-full hover:bg-[#E5B1A1] hover:text-white transition-all text-xl font-medium">
                      啟動合作
                    </button>
                  )}
                </div>
              </div>
            ) : (
              <div className="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                {/* Text Side */}
                <div className="space-y-8">
                  <div>
                    <h3 className="text-[#C5A059] font-medium tracking-widest mb-2">{slide.subtitle || "INDUSTRY INSIGHT"}</h3>
                    <h2 className="text-4xl md:text-5xl font-serif leading-tight">{slide.title}</h2>
                  </div>

                  {slide.type === "crisis" && (
                    <div className="grid grid-cols-3 gap-4">
                      {slide.stats.map((s, i) => (
                        <div key={i} className="bg-white p-4 rounded-2xl shadow-sm border-t-4 border-[#E5B1A1]">
                          <div className="text-3xl font-bold text-[#E5B1A1]">{s.value}</div>
                          <div className="text-sm font-medium">{s.label}</div>
                          <div className="text-[10px] text-gray-400">{s.sub}</div>
                        </div>
                      ))}
                    </div>
                  )}

                  {slide.features && (
                    <div className="space-y-6">
                      {slide.features.map((f, i) => (
                        <div key={i} className="flex items-start gap-4 p-4 bg-white rounded-2xl shadow-sm transition-transform hover:scale-[1.02]">
                          <div className="bg-[#F9F5F1] p-3 rounded-xl">{f.icon}</div>
                          <div>
                            <h4 className="font-bold text-lg">{f.title}</h4>
                            <p className="text-gray-500 text-sm">{f.text}</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}

                  {slide.points && (
                    <ul className="space-y-4">
                      {slide.points.map((p, i) => (
                        <li key={i} className="flex items-center gap-3 text-lg">
                          <CheckCircle className="w-6 h-6 text-[#E5B1A1]" />
                          <span>{p}</span>
                        </li>
                      ))}
                    </ul>
                  )}

                  {slide.grid && (
                    <div className="grid grid-cols-1 gap-6">
                      {slide.grid.map((item, i) => (
                        <div key={i} className="p-6 bg-white rounded-3xl border border-gray-100 shadow-sm">
                          <span className="text-xs px-2 py-1 bg-rose-50 text-rose-400 rounded-md font-bold mb-2 inline-block">{item.label}</span>
                          <h4 className="text-xl font-bold mb-2">{item.title}</h4>
                          <p className="text-gray-500 text-sm leading-relaxed">{item.desc}</p>
                        </div>
                      ))}
                    </div>
                  )}

                  {slide.steps && (
                    <div className="space-y-6">
                      {slide.steps.map((step, i) => (
                        <div key={i} className="flex gap-4">
                          <div className="w-10 h-10 rounded-full bg-[#E5B1A1] text-white flex items-center justify-center font-bold shrink-0">{i+1}</div>
                          <div>
                            <h4 className="font-bold">{step.title}</h4>
                            <p className="text-sm text-gray-500">{step.desc}</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}

                  {slide.phases && (
                    <div className="space-y-4">
                      {slide.phases.map((p, i) => (
                        <div key={i} className="p-4 bg-white rounded-xl shadow-sm border-l-4 border-[#C5A059]">
                          <h4 className="font-bold text-[#C5A059] mb-2">{p.label}</h4>
                          <div className="flex gap-2 flex-wrap">
                            {p.items.map((item, idx) => (
                              <span key={idx} className="bg-gray-100 text-gray-600 text-[10px] px-2 py-1 rounded-full">{item}</span>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                  )}

                  {slide.desc && <p className="text-gray-600 leading-relaxed text-lg">{slide.desc}</p>}
                  {slide.highlight && (
                    <div className="p-4 bg-[#E5B1A1]/10 border-l-4 border-[#E5B1A1] italic text-lg">
                      {slide.highlight}
                    </div>
                  )}
                </div>

                {/* Image / Mockup Side */}
                <div className="flex justify-center items-center">
                  {slide.img ? (
                    <div className="relative group">
                      <div className="absolute -inset-4 bg-[#E5B1A1]/20 rounded-[40px] rotate-2 transition-transform group-hover:rotate-0" />
                      <img src={slide.img} className="relative rounded-[40px] shadow-2xl object-cover h-[500px] w-full max-w-md" alt="slide visual" />
                    </div>
                  ) : slide.mockup ? (
                    <div className="w-72 h-[550px] bg-gray-900 rounded-[3rem] border-[8px] border-gray-800 shadow-2xl overflow-hidden relative">
                      <div className="absolute top-0 w-full h-6 bg-gray-800 flex justify-center items-center">
                        <div className="w-12 h-1 bg-gray-700 rounded-full" />
                      </div>
                      <div className="p-6 pt-10 bg-white h-full flex flex-col">
                        <div className="flex justify-between items-center mb-6">
                          <span className="text-[10px] font-bold text-gray-400">BEAUTY PASS</span>
                          <Users className="w-4 h-4 text-[#E5B1A1]" />
                        </div>
                        <div className="bg-gradient-to-br from-[#E5B1A1] to-[#C5A059] p-6 rounded-2xl text-white shadow-lg mb-6">
                          <div className="text-[10px] opacity-80 mb-1">數位儲值餘額</div>
                          <div className="text-3xl font-serif font-bold">$12,000</div>
                          <div className="mt-4 flex justify-between items-end">
                            <span className="text-[8px]">公會認證誠信店家</span>
                            <span className="text-[8px]">A沙龍 專屬</span>
                          </div>
                        </div>
                        <div className="space-y-3">
                          <div className="text-[10px] font-bold text-gray-400">美麗積分 (美麗金)</div>
                          <div className="flex items-center gap-2">
                            <div className="w-8 h-8 rounded-full bg-rose-50 flex items-center justify-center text-rose-400 text-xs">P</div>
                            <span className="text-lg font-bold">1,250 點</span>
                          </div>
                        </div>
                        <div className="mt-auto mb-4 bg-gray-50 p-4 rounded-xl border border-dashed border-gray-200">
                          <p className="text-[10px] text-gray-400 text-center italic">「公會雲端紀錄，消費有保障」</p>
                        </div>
                      </div>
                    </div>
                  ) : (
                    <div className="w-full flex justify-center">
                      <div className="w-80 h-80 bg-white rounded-full flex items-center justify-center shadow-xl relative">
                        <div className="absolute inset-4 border-2 border-dashed border-[#E5B1A1] rounded-full animate-spin-slow" />
                        <Layout className="w-24 h-24 text-[#E5B1A1] opacity-50" />
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
        </div>
      </main>

      {/* Footer Navigation */}
      <footer className="p-8 flex justify-between items-center bg-white/50 backdrop-blur-md">
        <div className="flex items-center gap-4">
          <div className="text-sm font-medium text-gray-400">
            <span className="text-[#333333]">{String(currentSlide + 1).padStart(2, '0')}</span> / {slides.length}
          </div>
          <div className="hidden md:flex gap-1">
            {slides.map((_, i) => (
              <div 
                key={i} 
                className={`h-1 transition-all duration-300 ${i === currentSlide ? 'w-8 bg-[#E5B1A1]' : 'w-2 bg-gray-200'}`} 
              />
            ))}
          </div>
        </div>
        
        <div className="flex gap-4">
          <button 
            onClick={prevSlide}
            className="p-3 rounded-full hover:bg-white transition-colors disabled:opacity-30 border border-gray-100"
            disabled={currentSlide === 0}
          >
            <ChevronLeft />
          </button>
          <button 
            onClick={nextSlide}
            className="p-3 bg-[#333333] text-white rounded-full hover:bg-[#E5B1A1] transition-all shadow-lg"
          >
            {currentSlide === slides.length - 1 ? <Layout /> : <ChevronRight />}
          </button>
        </div>
      </footer>

      {/* Speaker Notes Overlay (Optional) */}
      <div className="fixed bottom-4 left-4 group z-50">
        <div className="bg-white/80 p-2 rounded-full shadow-lg cursor-help text-[#E5B1A1]">
          <BarChart3 className="w-5 h-5" />
        </div>
        <div className="absolute bottom-full left-0 mb-4 w-80 bg-white p-6 rounded-2xl shadow-2xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none border border-gray-100">
          <h5 className="font-bold mb-2 text-sm text-[#C5A059]">會長提案腳本</h5>
          <p className="text-xs text-gray-500 leading-relaxed italic">
            "{slides[currentSlide].id === 1 ? "各位會長好，今天我們要分享的「美力圈」，不僅是一個 App，而是要為我們美業職人打造一座守護產值的數位長城。" : slides[currentSlide].id === 10 ? "會長，這不僅是技術升級，更是產業地位的翻轉。讓我們一起為美業創造下一個黃金十年。" : "強調公會的領導地位與對會員店家的實質幫助，解決放鳥損失與導流問題。"}"
          </p>
        </div>
      </div>

      <style dangerouslySetInnerHTML={{ __html: `
        .animate-spin-slow { animation: spin 10s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.7s ease-out forwards; }
        font-family: 'Noto Serif TC', serif;
      `}} />
    </div>
  );
};

export default App;